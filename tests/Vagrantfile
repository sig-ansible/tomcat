# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|
  #config.vm.box = "bento/centos-6.7"
  # config.vm.box = "bento/centos-7.6"
  # config.vm.box = "bento/centos-8"
  config.vm.box = "almalinux/8"

  config.vm.provider "virtualbox" do |vb|
    # Customize the amount of memory on the VM:
    vb.memory = "2048"

    #vb.gui = true
  end

  config.vm.network "forwarded_port", guest: 8080, host: 8081
  config.vm.network "forwarded_port", guest: 8443, host: 8443
  config.vm.network "forwarded_port", guest: 9080, host: 9080
  config.vm.synced_folder "artifacts", "/mnt/artifacts"

  # Ansible pre-requisites
  # config.vm.provision "shell", inline: "yum install -y python3-pip"
  # config.vm.provision "shell", inline: "python3 -m pip install --upgrade pip"
  # config.vm.provision "shell", inline: "pip3 install cryptography pyOpenSSL --upgrade"
  config.vm.provision "shell", inline: "yum install -y python3-cryptography python3-pyOpenSSL java-1.8.0-openjdk python3-lxml"

  # Run Ansible
  config.vm.provision "ansible" do |ansible|
    ansible.playbook = "test.yml"
    # ansible.tags = "debug"
    # ansible.vault_password_file = "../../vault_from_env.sh"
    # ansible.verbose = "vvv"
  end
end
